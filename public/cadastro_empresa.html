<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - NAVIX</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
    <link rel="icon" href="./assets/navix-logo.jpg">
    <link rel="stylesheet" href="./css/index.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
</head>

<body class="bg-slate-100 min-h-screen flex flex-col">
    <header class="h-30 w-full px-15 flex items-center justify-between fixed bg-slate-900 bg-opacity-50">
        <div>
            <a href="index.html">
                <div class="h-22 w-22 bg-slate-300 rounded-full" id="logo"></div>
            </a>
        </div>
        <div class="w-120 content-center">
            <ul class="flex justify-between cabecalho">
                <a href="./index.html" class="content-center">
                    <li class="text-slate-100">Home</li>
                </a>
                <a href="./aboutUs.html" class="content-center">
                    <li class="text-slate-100">Sobre nós</li>
                </a>
                <a href="./login.html">
                    <li
                        class="border border-4 border-solid border-slate-100 pb-2 pt-2 pl-7 pr-7 rounded-sm text-slate-100">
                        Entrar</li>
                </a>
            </ul>
        </div>
    </header>
    <div class="bg-slate-200 flex-grow flex items-center justify-center px-6 py-6 h-screen">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mt-40 p-10">

            <h1 class="text-3xl font-bold text-blue-900 mb-6 text-center">Cadastro da Empresa</h1>

            <div id="cardMensagem" class="hidden px-4 py-3 rounded mb-4">
                <span id="mensagem_status"></span>
            </div>

            <form onsubmit="event.preventDefault(); cadastrar_empresa();" class="flex flex-col gap-4">

                <input id="razaoSocial_input" type="text" placeholder="Razão Social"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="cnpj_input" type="number" placeholder="CNPJ (somente números)"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="codigo_ativacao_input" type="text" placeholder="Código de Ativação"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="cep_input" type="number" placeholder="CEP"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="estado_input" type="text" placeholder="Estado"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="cidade_input" type="text" placeholder="Cidade"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="bairro_input" type="text" placeholder="Bairro"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="rua_input" type="text" placeholder="Rua"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <input id="numero_input" type="number" placeholder="Número"
                    class="px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

                <button type="submit"
                    class="w-full bg-blue-900 text-white py-3 rounded hover:bg-blue-800 transition hover:cursor-pointer">
                    Cadastrar
                </button>
            </form>


            <p class="mt-4 text-center text-gray-600 text-sm">
                Já tem uma conta? <a href="login.html" class="text-blue-800 font-semibold">Entrar</a>
            </p>
        </div>
    </div>
</body>

</html>
<script>
    console.log("Está abrindo o script")

    //import { sumirMensagem } from '../sessao.js';

    function mostrarMensagem(tipo, texto) {
        const card = document.getElementById("cardMensagem");
        const mensagem = document.getElementById("mensagem_status");

        mensagem.textContent = texto;

        card.className = "px-4 py-3 rounded mb-4";

        if (tipo === "sucesso") {
            card.classList.add("bg-green-200", "text-green-800");
        } else {
            card.classList.add("bg-red-200", "text-red-800");
        }

        card.classList.remove("hidden");
        // setTimeout(sumirMensagem, 7000);
    }

    // function mostrarLoading() {
    //     document.getElementById('loading').classList.remove('hidden');
    // }

    // function esconderLoading() {
    //     document.getElementById('loading').classList.add('hidden');
    // }

    async function cadastrar_empresa() {
        var razaoSocial = razaoSocial_input.value;
        var cnpj = cnpj_input.value;
        var codigoAtivacao = codigo_ativacao_input.value;
        var cep = cep_input.value;
        var estado = estado_input.value;
        var cidade = cidade_input.value;
        var bairro = bairro_input.value;
        var rua = rua_input.value;
        var numero = numero_input.value;

        const verificacao = [razaoSocial, cnpj];

        if (
            razaoSocial == "" ||
            cnpj == "" ||
            codigoAtivacao == "" ||
            cep == "" ||
            numero == "" ||
            estado == "" ||
            cidade == "" ||
            bairro == "" ||
            rua == ""
        ) {
            Swal.fire({
                icon: "warning",
                title: "Aviso",
                text: "Todos os campos precisam ser preenchidos!",
                background: "#0f172b",
                color: "#f1f1f1",
            });
            return false;
        }

        try {
            const resposta = await fetch("empresa/cadastrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    razaoSocialServer: razaoSocial,
                    cnpjServer: cnpj,
                    codigoServer: codigoAtivacao,
                    cepServer: cep,
                    estadoServer: estado,
                    cidadeServer: cidade,
                    bairroServer: bairro,
                    ruaServer: rua,
                    numeroServer: numero
                }),
            });

            console.log("resposta: ", resposta.status);

            if (resposta.ok) {
                Swal.fire({
                    title: "Empresa cadastrada com sucesso!",
                    text: "Redirecionando para a tela de Login...",
                    icon: "success",
                    draggable: true,
                    timer: 3000,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: "rgb(20, 20, 20)",
                    color: "#f1f1f1",
                });
                setTimeout(() => {
                    window.location = "login.html";
                }, 3000);
            } else {
                resposta.json().then((erro) => {
                    console.error(erro);
                    Swal.fire({
                        title: "Erro ao cadastrar!",
                        text:
                            erro.mensagem || "Houve um erro no servidor. Tente novamente.",
                        icon: "error",
                        draggable: true,
                        background: "rgb(20, 20, 20)",
                        color: "#f1f1f1",
                    });
                });
            }
        } catch (erro) {
            console.log(`#ERRO: ${erro}`);
            Swal.fire({
                title: "Erro na comunicação!",
                text: "Não foi possível se conectar ao servidor. Verifique sua conexão.",
                icon: "error",
                draggable: true,
                background: "rgb(20, 20, 20)",
                color: "#f1f1f1",
            });
        };

        return false;
    }

    window.cadastrar_empresa = cadastrar_empresa;

</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>